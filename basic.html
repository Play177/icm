
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ICM 8-MAX - Edición High-Tech</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --table-bg: radial-gradient(circle, #0a1a2e 0%, #020a13 100%);
      --table-border: #00f2fe;
      --hero-glow: 0 0 20px #00f2fe, 0 0 30px #008cff;
      --villain-glow: 0 0 10px rgba(0, 242, 254, 0.5);
      --neon-text: #00f2fe;
      --neon-pink: #ff00ff;
      --chip-gradient: linear-gradient(135deg, #00f2fe 0%, #008cff 100%);
      --bb-gradient: linear-gradient(135deg, #ff00ff 0%, #ff0066 100%);
    }

    body {
      font-family: 'Rajdhani', 'Segoe UI', sans-serif;
      background: #020a13;
      margin: 0;
      padding: 20px;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      flex-direction: column;
    }

    .container {
      max-width: 900px;
      width: 100%;
    }

    h1 {
      text-align: center;
      color: var(--neon-text);
      margin-bottom: 10px;
      text-shadow: var(--hero-glow);
      font-weight: 700;
      letter-spacing: 2px;
      font-size: 2.2rem;
    }

    .subtitle {
      text-align: center;
      color: rgba(0, 242, 254, 0.7);
      margin-top: -15px;
      font-size: 0.9rem;
      letter-spacing: 1px;
    }

    .input-section {
      background: rgba(0, 242, 254, 0.05);
      border: 1px solid rgba(0, 242, 254, 0.3);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .input-section label {
      display: block;
      margin: 8px 0 4px;
      font-size: 14px;
    }

    .input-section input {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(0, 242, 254, 0.4);
      color: white;
      font-size: 14px;
    }

    .buttons button {
      padding: 10px 20px;
      margin-top: 10px;
      margin-right: 10px;
      background: var(--chip-gradient);
      border: none;
      border-radius: 20px;
      font-weight: bold;
      color: #020a13;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0, 242, 254, 0.5);
    }

    .buttons button:hover {
      box-shadow: 0 0 20px rgba(0, 242, 254, 0.9);
    }

    pre {
      background: rgba(0, 0, 0, 0.2);
      padding: 10px;
      border-radius: 8px;
      font-size: 13px;
      color: #aeefff;
      white-space: pre-wrap;
    }

    #graficoICM {
      max-width: 100%;
      margin-top: 20px;
      background: #fff;
      border-radius: 10px;
      padding: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ICM 8-MAX <span class="subtitle">Edición High-Tech</span></h1>

    <div class="input-section">
      <label>Fichas de los Jugadores (separadas por comas)</label>
      <input id="stacks" placeholder="Ej: 5000,4000,3000,2000">

      <label>Distribución de Premios (%) (Ej: 50,30,20 o 40,25,20,15)</label>
      <input id="payouts" placeholder="Ej: 50,30,20">

      <label>Simular Eliminación (opcional - jugadores separados por comas, comenzando en 1)</label>
      <input id="eliminar" placeholder="Ej: 2,5 para eliminar al segundo y quinto jugador">

      <div class="buttons">
        <button onclick="calcularICM()">Calcular ICM</button>
        <button onclick="exportarCSV()">Exportar CSV</button>
        <button onclick="exportarPDF()">Exportar PDF</button>
      </div>

      <pre id="resultadoICM"></pre>
      <canvas id="graficoICM"></canvas>
    </div>

    <div class="input-section">
      <label>Mano 1 (ej: AhKh)</label>
      <input id="mao1" placeholder="Ej: AhKh">
      <label>Mano 2 (ej: QcQs)</label>
      <input id="mao2" placeholder="Ej: QcQs">
      <label>Board (opcional - ej: 2h7dTc)</label>
      <input id="board" placeholder="Ej: 2h7dTc">
      <div class="buttons">
        <button onclick="calcularOddsMock()">Calcular Probabilidad</button>
      </div>
      <pre id="resultadoOdds"></pre>
    </div>
  </div>

  <script>
    let chartICM = null;
    let ultimoResultado = {};

    function permutaciones(arr) {
      if (arr.length === 1) return [arr];
      let result = [];
      for (let i = 0; i < arr.length; i++) {
        const current = arr[i];
        const remaining = arr.slice(0, i).concat(arr.slice(i + 1));
        const perms = permutaciones(remaining);
        for (const p of perms) result.push([current].concat(p));
      }
      return result;
    }

    function calcularICM() {
      const stacks = document.getElementById("stacks").value.trim().split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
      const payouts = document.getElementById("payouts").value.trim().split(',').map(x => parseFloat(x.trim()) / 100).filter(x => !isNaN(x));
      const eliminar = document.getElementById("eliminar").value.trim();

      if (eliminar !== "") {
        eliminar.split(',').map(x => parseInt(x.trim()) - 1).forEach(idx => {
          if (idx >= 0 && idx < stacks.length) stacks[idx] = 0;
        });
      }

      if (stacks.length === 0 || payouts.length === 0) {
        document.getElementById("resultadoICM").textContent = "Ingrese fichas y premios válidos.";
        return;
      }

      const totalPrize = 100;
      const resultado = {};
      stacks.forEach((_, i) => resultado[i] = 0);
      const perms = permutaciones(stacks.map((_, i) => i));

      for (const orden of perms) {
        let prob = 1;
        let restante = orden.slice();
        let valores = [...stacks];
        for (let pos = 0; pos < Math.min(restante.length, payouts.length); pos++) {
          const totalStack = restante.reduce((sum, idx) => sum + valores[idx], 0);
          const actual = restante[0];
          const p = valores[actual] / totalStack;
          prob *= p;
          resultado[actual] += prob * payouts[pos] * totalPrize;
          restante.shift();
        }
      }

      let salida = "Resultados ICM:\n";
      Object.entries(resultado).forEach(([i, v]) => {
        salida += `Jugador ${+i + 1}: $${v.toFixed(2)}\n`;
      });
      document.getElementById("resultadoICM").textContent = salida;
      ultimoResultado = resultado;
      actualizarGrafico(resultado);
    }

    function actualizarGrafico(resultado) {
      const labels = Object.keys(resultado).map(i => `Jugador ${+i + 1}`);
      const valores = Object.values(resultado);
      const colores = valores.map((_, i, arr) => {
        const rank = [...arr].sort((a,b) => b-a).indexOf(arr[i]);
        return rank < 3 ? ["#00f2fe", "#ff00ff", "#00ff99"][rank] : "#888";
      });

      if (chartICM) chartICM.destroy();
      const ctx = document.getElementById("graficoICM").getContext("2d");
      chartICM = new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'Valor ICM ($)',
            data: valores.map(v => v.toFixed(2)),
            backgroundColor: colores
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } }
        }
      });
    }

    function calcularOddsMock() {
      const m1 = document.getElementById("mao1").value.trim().toUpperCase();
      const m2 = document.getElementById("mao2").value.trim().toUpperCase();
      let resultado = "Probabilidad estimada:\n";

      if (m1.includes("A") && m2.includes("Q")) {
        resultado += "Mano 1: 65%\nMano 2: 35%";
      } else if (m1 === m2) {
        resultado += "Empate: 50% para cada";
      } else {
        resultado += "Mano 1: 50%\nMano 2: 50% (estimado)";
      }

      document.getElementById("resultadoOdds").textContent = resultado;
    }

    function exportarCSV() {
      if (!ultimoResultado || Object.keys(ultimoResultado).length === 0) return alert("Calcule el ICM primero.");
      let csv = "Jugador,ICM\n";
      Object.entries(ultimoResultado).forEach(([i, v]) => csv += `Jugador ${+i + 1},${v.toFixed(2)}\n`);
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'resultado_icm.csv';
      a.click();
    }

    function exportarPDF() {
      if (!ultimoResultado || Object.keys(ultimoResultado).length === 0) return alert("Calcule el ICM primero.");
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(14);
      doc.text("Resultados ICM", 20, 20);
      let y = 30;
      Object.entries(ultimoResultado).forEach(([i, v]) => {
        doc.text(`Jugador ${+i + 1}: $${v.toFixed(2)}`, 20, y);
        y += 10;
      });
      doc.save("resultado_icm.pdf");
    }
  </script>
</body>
</html>