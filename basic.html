
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ICM Basic</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --table-bg: radial-gradient(circle, #0a1a2e 0%, #020a13 100%);
      --table-border: #00f2fe;
      --hero-glow: 0 0 20px #00f2fe, 0 0 30px #008cff;
      --villain-glow: 0 0 10px rgba(0, 242, 254, 0.5);
      --neon-text: #00f2fe;
      --neon-pink: #ff00ff;
      --chip-gradient: linear-gradient(135deg, #00f2fe 0%, #008cff 100%);
      --bb-gradient: linear-gradient(135deg, #ff00ff 0%, #ff0066 100%);
    }

    body {
      font-family: 'Rajdhani', 'Segoe UI', sans-serif;
      background: #020a13;
      margin: 0;
      padding: 20px;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      flex-direction: column;
    }

    .container {
      max-width: 900px;
      width: 100%;
    }

    h1 {
      text-align: center;
      color: var(--neon-text);
      margin-bottom: 10px;
      text-shadow: var(--hero-glow);
      font-weight: 700;
      letter-spacing: 2px;
      font-size: 2.2rem;
    }

    .subtitle {
      text-align: center;
      color: rgba(0, 242, 254, 0.7);
      margin-top: -15px;
      font-size: 0.9rem;
      letter-spacing: 1px;
    }

    .input-section {
      background: rgba(0, 242, 254, 0.05);
      border: 1px solid rgba(0, 242, 254, 0.3);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .input-section label {
      display: block;
      margin: 8px 0 4px;
      font-size: 14px;
    }

    .input-section input {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(0, 242, 254, 0.4);
      color: white;
      font-size: 14px;
    }

    .buttons button {
      padding: 10px 20px;
      margin-top: 10px;
      margin-right: 10px;
      background: var(--chip-gradient);
      border: none;
      border-radius: 20px;
      font-weight: bold;
      color: #020a13;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0, 242, 254, 0.5);
    }

    .buttons button:hover {
      box-shadow: 0 0 20px rgba(0, 242, 254, 0.9);
    }

    pre {
      background: rgba(0, 0, 0, 0.2);
      padding: 10px;
      border-radius: 8px;
      font-size: 13px;
      color: #aeefff;
      white-space: pre-wrap;
    }

    #graficoICM {
      max-width: 100%;
      margin-top: 20px;
      background: #fff;
      border-radius: 10px;
      padding: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ICM  <span class="subtitle">Basic</span></h1>

    <div class="input-section">
      <label>Fichas de los Jugadores (separadas por comas)</label>
      <input id="stacks" placeholder="Ej: 5000,4000,3000,2000">

      <label>Distribución de Premios (Ej: 50,30,20 o 40,25,20,15)</label>
      <input id="payouts" placeholder="Ej: 50,30,20">

      <label>Simular Eliminación (opcional - jugadores separados por comas, comenzando en 1)</label>
      <input id="eliminar" placeholder="Ej: 2,5 para eliminar al segundo y quinto jugador">

      <div class="buttons">
        <button onclick="calcularICM()">Calcular ICM</button>
      </div>

      <pre id="resultadoICM"></pre>
      <canvas id="graficoICM"></canvas>
    </div>
  </div>
<script>
  let chartICM = null;

  // Algoritmo ICM exacto usando permutaciones (brute force)
  function calculateICM(stacks, payouts) {
    const n = stacks.length;
    const premios = payouts.slice().sort((a, b) => b - a);
    const icmValues = Array(n).fill(0);

    function permute(playersLeft, probSoFar, payoutsLeft) {
      if (payoutsLeft.length === 0) return;

      const totalStack = playersLeft.reduce((acc, p) => acc + stacks[p], 0);

      for (let i = 0; i < playersLeft.length; i++) {
        const p = playersLeft[i];
        const prob = stacks[p] / totalStack;
        const newProb = probSoFar * prob;

        // Asignar premio actual a este jugador
        icmValues[p] += newProb * payoutsLeft[0];

        // Continuar con próximos premios y jugadores
        const newPlayers = playersLeft.slice();
        newPlayers.splice(i, 1);
        permute(newPlayers, newProb, payoutsLeft.slice(1));
      }
    }

    const active = stacks.map((s, i) => i).filter(i => stacks[i] > 0);
    permute(active, 1, premios);
    return icmValues;
  }

  function calcularICM() {
    const stackInput = document.getElementById("stacks").value;
    const payoutInput = document.getElementById("payouts").value;
    const eliminarInput = document.getElementById("eliminar").value;

    let stacks = stackInput.split(",").map(s => parseFloat(s.trim())).filter(n => !isNaN(n));
    let payouts = payoutInput.split(",").map(p => parseFloat(p.trim())).filter(n => !isNaN(n));
    const eliminados = eliminarInput
      .split(",")
      .map(i => parseInt(i.trim()) - 1)
      .filter(i => !isNaN(i));

    eliminados.forEach(i => {
      if (i >= 0 && i < stacks.length) stacks[i] = 0;
    });

    if (stacks.length === 0 || payouts.length === 0) {
      alert("Por favor ingresa stacks y premios válidos en dinero real.");
      return;
    }

    const icmRaw = calculateICM(stacks, payouts);

    // Mostrar resultados
    mostrarResultados(icmRaw);
    actualizarGrafico(icmRaw);
  }

  function mostrarResultados(resultado) {
    let salida = "Resultados ICM:\n";
    resultado.forEach((v, i) => {
      salida += `Jugador ${i + 1}: $${v.toFixed(2)}\n`;
    });
    document.getElementById("resultadoICM").textContent = salida;
  }

  function actualizarGrafico(resultado) {
    const labels = resultado.map((_, i) => `Jugador ${i + 1}`);
    const valores = resultado;
    const colores = valores.map((_, i, arr) => {
      const rank = [...arr].sort((a, b) => b - a).indexOf(arr[i]);
      return rank < 3 ? ["#00f2fe", "#ff00ff", "#00ff99"][rank] : "#888";
    });

    if (chartICM) chartICM.destroy();
    const ctx = document.getElementById("graficoICM").getContext("2d");
    chartICM = new Chart(ctx, {
      type: 'bar',
      data: {
        labels,
        datasets: [{
          label: 'Valor ICM ($)',
          data: valores.map(v => v.toFixed(2)),
          backgroundColor: colores
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          y: {
            beginAtZero: true,
            title: { display: true, text: 'Valor ICM ($)' }
          }
        }
      }
    });
  }
</script>



</body>
</html>

